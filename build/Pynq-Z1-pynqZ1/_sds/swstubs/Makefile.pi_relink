ADDRESS_MAP:=/home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/_sds/p0/.cf_work/address_map.xml

OUTPUT:=mlp.so

.PHONY: relink clean

relink: portinfo.o
	arm-linux-gnueabihf-ar crs libxlnk_stub.a portinfo.o /home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/_sds/swstubs/cf_stub.o
	arm-linux-gnueabihf-g++ -L./    /home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/_sds/swstubs/mlp.o /home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/pynqlib.o /home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/_sds/swstubs/host.o /home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/_sds/swstubs/cf_stub.o portinfo.o -fPIC -Wall -shared    -L/home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/_sds/swstubs -L /tools/Xilinx/SDx/2018.3/target/aarch32-linux/lib -lsds_lib -o mlp.so
	arm-linux-gnueabihf-objcopy -R .xdinfo -R .xddata -R .xdasm -R .xdfcnmap -R .xdhlscore -R .xdif -R .xdparams -R .xdcore -R .xdrepo -R .xdsdata -R .xdpp -R .xdrtlx mlp.so
	rm libxlnk_stub.a portinfo.o portinfo.h portinfo.c

portinfo.o: ${ADDRESS_MAP} 
	/tools/Xilinx/SDx/2018.3/bin/cf2sw -i /home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/_sds/.llvm/apsys_0.xml -r /home/steve/Graduate_Research/MLP/build/Pynq-Z1-pynqZ1/_sds/.cdb/xd_ip_db.xml -a ${ADDRESS_MAP} -pollMode 0 -mc 
	arm-linux-gnueabihf-gcc       -I /tools/Xilinx/SDx/2018.3/target/aarch32-linux/include  -D HLS_NO_XIL_FPO_LIB  -I /tools/Xilinx/Vivado/2018.3/include -c -fPIC portinfo.c

clean:
	rm -f portinfo.o portinfo.h portinfo.c ${OUTPUT} libxlnk_stub.a
